<?xml version="1.0" encoding="UTF-8"?>
<modification>
	<id>OpenCart Shortcodes</id>
	<version>v.1.0-Beta</version>
	<vqmver>2.3.2</vqmver>
	<author>qahar [echothemes.com]</author>
   <file name="system/startup.php">
      <operation error="abort" info="Load shortcodes library">
         <search position="after"><![CDATA[DIR_SYSTEM . 'engine/action.php']]></search>
         <add><![CDATA[
         define('SHORTCODES_VERSION', '1.0-Beta');
         require_once(DIR_SYSTEM . 'library/shortcodes_wp.php');
         ]]></add>
      </operation>
   </file>
   <file name="catalog/controller/common/maintenance.php">
      <operation error="log" info="Load default and extend shortcodes ">
         <search position="after"><![CDATA[function index()]]></search>
         <add><![CDATA[
         //=========== OpenCart Shortcodes
         
         //=== Default shortcode
         $this->load->library('shortcodes');
         
         $class      = new Shortcodes($this->registry);
         $shortcodes = get_class_methods('shortcodes');
         $shortcodes = array_slice($shortcodes, 3);
         foreach ($shortcodes as $shortcode) {
            add_shortcode($shortcode, $shortcode, $class);
         }
         
         //=== Themes extending shortcode
         $file = DIR_TEMPLATE . $this->config->get('config_template') . '/shortcodes.php';
         if (file_exists($file)) {
            include_once($file);
            
            $class      = new themeShortcodes($this->registry);
            $shortcodes = get_class_methods('themeShortcodes');
            foreach ($shortcodes as $shortcode) {
               add_shortcode($shortcode, $shortcode, $class);
            }
         }
         
         //=========== END :: OpenCart Shortcodes
         ]]></add>
      </operation>		
   </file>
   <file name="system/engine/controller.php">
      <operation error="log" info="Execute shortcode tags">
      <search position="before"><![CDATA[return $this->output;]]></search>
      <add><![CDATA[
	//exclude route         
	$arr_exclude = array('product/product/review');
	
	$route = (isset($this->request->get['route'])) ? $this->request->get['route'] : ''; 
	if (! in_array($route,$arr_exclude)) {
	$this->output = do_shortcode($this->output);
	}
	]]></add>
	</operation>
   </file>
</modification>
